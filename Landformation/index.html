<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Landforms: Dominant Process & Agent of Formation</title>
  <style>
    /* Page Setup */
    body {
      margin: 20px;
      font-family: Arial, sans-serif;
      background-color: #fff;
    }
    h1 {
      margin-bottom: 10px;
    }

    /* Main layout: table left, banks right */
    #mainContainer {
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }
    #tableContainer {
      flex: 0 0 auto;
    }

    /* TABLE with fixed layout: exactly 3 columns, no extra cells */
    table {
      table-layout: fixed;  
      width: 800px;         
      border-collapse: separate;
      border-spacing: 0;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 0 4px rgba(0,0,0,0.2);
    }

    /* Dark orange header with white text */
    thead tr {
      background-color: #d97b00;
      color: #fff;
    }
    thead th {
      height: 36px;
      padding: 6px 8px;
      font-size: 0.9em;
      white-space: nowrap;
    }

    /* Alternate row colors: row1=light, row2=dark, row3=light, etc. */
    tbody tr:nth-child(odd) {
      background-color: #fce0b8; /* light orange */
      color: #000;
    }
    tbody tr:nth-child(even) {
      background-color: #d97b00; /* dark orange */
      color: #fff;
    }

    /* Each row has 3 cells: 
       1) Landform (read-only) 
       2) Dominant Process (dropzone)
       3) Agent of Formation (dropzone) */
    th, td {
      border: none;
      text-align: center;
      vertical-align: middle;
      height: 36px;
      padding: 4px 6px;
      overflow: hidden;    /* no extra lines */
      white-space: nowrap;
      text-overflow: ellipsis;
      font-size: 0.9em;
    }

    /* The dropzone spans the entire cell area */
    .dropzone {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    /* The right-hand banks (no border) */
    #banksContainer {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .bank h2 {
      margin: 0 0 4px;
      font-size: 1em;
      background: #eee;
      padding: 4px 6px;
      border-radius: 4px;
    }

    /* Draggables */
    .draggable {
      margin: 4px 0;
      padding: 4px 8px;
      cursor: move;
      border-radius: 6px;
      text-align: center;
      font-size: 0.9em;
      display: inline-block;
      white-space: nowrap;
    }
    .draggable:hover {
      opacity: 0.85;
    }
    /* White w/ orange border => Dominant Process */
    .process-item {
      background-color: #fff;
      border: 2px solid orange;
      color: #333;
    }
    /* Orange w/ white border => Agent */
    .agent-item {
      background-color: orange;
      border: 2px solid #fff;
      color: #fff;
    }

    /* Dropzone highlight on dragover */
    .highlight {
      outline: 2px dashed #777;
    }

    /* Correct/incorrect occupant background */
    .correct {
      background-color: #c3f7c3 !important;
      color: #000 !important;
    }
    .incorrect {
      background-color: #f9c3c3 !important;
      color: #000 !important;
    }

    /* Buttons */
    .btn {
      margin-top: 12px;
      padding: 6px 12px;
      font-size: 0.9em;
      border: none;
      border-radius: 20px;
      cursor: pointer;
    }
    #checkButton {
      background-color: #007bff;
      color: #fff;
    }
    #retryButton {
      background-color: #ccc;
      color: #333;
      margin-left: 8px;
    }
    #copyButton {
      background-color: #28a745;
      color: #fff;
      margin-left: 8px;
      display: none;
    }
  </style>
</head>
<body>

<h1>Landforms: Dominant Process &amp; Agent of Formation</h1>
<p><em>
Each row is fully one color (light or dark orange). One dropzone for Dominant Process, one for Agent. Only one occupant per cell. The “Agent” column definitely accepts drops. 
When all are correct, a “Copy” button appears. 
</em></p>

<div id="mainContainer">
  <!-- LEFT: Table -->
  <div id="tableContainer">
    <table id="landformsTable">
      <thead>
        <tr>
          <th>LANDFORM</th>
          <th>DOMINANT PROCESS</th>
          <th>AGENT OF FORMATION</th>
        </tr>
      </thead>
      <tbody>
        <!-- 12 rows built dynamically -->
      </tbody>
    </table>

    <button id="checkButton" class="btn">Check</button>
    <button id="retryButton" class="btn">Restart</button>
    <button id="copyButton" class="btn">Copy</button>
  </div>

  <!-- RIGHT: Banks of draggables -->
  <div id="banksContainer">
    <div class="bank" id="processBank">
      <h2>Dominant Processes</h2>
    </div>
    <div class="bank" id="agentBank">
      <h2>Agents of Formation</h2>
    </div>
  </div>
</div>

<script>
// ---------------- DATA ----------------
const landformsData = [
  { landform: "Butte",         process: "Erosional",    agent: "Aeolian"   },
  { landform: "Volcano",       process: "Tectonic",     agent: "Volcanic"  },
  { landform: "Flood Plain",   process: "Depositional", agent: "Fluvial"   },
  { landform: "Mesa",          process: "Erosional",    agent: "Aeolian"   },
  { landform: "Harbour",       process: "Erosional",    agent: "Coastal"   },
  { landform: "Delta",         process: "Depositional", agent: "Fluvial"   },
  { landform: "River",         process: "Erosional",    agent: "Fluvial"   },
  { landform: "Glacier",       process: "Erosional",    agent: "Glacial"   },
  { landform: "Mountain",      process: "Tectonic",     agent: "Orogenic"  },
  { landform: "Canyon",        process: "Erosional",    agent: "Fluvial"   },
  { landform: "Island Arch.",  process: "Tectonic",     agent: "Volcanic"  },
  { landform: "Beach",         process: "Depositional", agent: "Coastal"   }
];

const processes = ["Erosional","Tectonic","Depositional"];
const agents   = ["Aeolian","Volcanic","Fluvial","Coastal","Glacial","Orogenic"];

// ---------------- BUILD TABLE ROWS ----------------
const tbody = document.querySelector("#landformsTable tbody");

landformsData.forEach((obj, i) => {
  const tr = document.createElement("tr");

  // 1) Landform cell
  const tdLand = document.createElement("td");
  tdLand.textContent = obj.landform;
  tr.appendChild(tdLand);

  // 2) Dominant Process cell (dropzone)
  const tdProc = document.createElement("td");
  tdProc.classList.add("dropzone");
  tdProc.dataset.rowIndex = i;
  tdProc.dataset.colType = "process";
  tr.appendChild(tdProc);

  // 3) Agent of Formation cell (dropzone)
  const tdAgent = document.createElement("td");
  tdAgent.classList.add("dropzone");
  tdAgent.dataset.rowIndex = i;
  tdAgent.dataset.colType = "agent";
  tr.appendChild(tdAgent);

  tbody.appendChild(tr);
});

// ---------------- BUILD BANK ITEMS (ONE PER TYPE, INFINITE USAGE) ----------------
const processBank = document.getElementById("processBank");
const agentBank   = document.getElementById("agentBank");

processes.forEach(proc => {
  const div = document.createElement("div");
  div.classList.add("draggable","process-item");
  div.setAttribute("draggable","true");
  div.textContent = proc;
  // Each bank item has its own dragstart => clone approach
  div.addEventListener("dragstart", onBankItemDragStart);
  processBank.appendChild(div);
});

agents.forEach(a => {
  const div = document.createElement("div");
  div.classList.add("draggable","agent-item");
  div.setAttribute("draggable","true");
  div.textContent = a;
  div.addEventListener("dragstart", onBankItemDragStart);
  agentBank.appendChild(div);
});

// ---------------- DROPZONES (PROCESS & AGENT) ----------------
document.querySelectorAll(".dropzone").forEach(zone => {
  zone.addEventListener("dragover", onDropzoneDragOver);
  zone.addEventListener("dragleave", onDragLeave);
  zone.addEventListener("drop", onDropzoneDrop);
});

// Also allow cell->bank dragging
[processBank, agentBank].forEach(bank => {
  bank.addEventListener("dragover", (e) => {
    e.preventDefault();
    bank.classList.add("highlight");
    e.dataTransfer.dropEffect = "move";
  });
  bank.addEventListener("dragleave", () => {
    bank.classList.remove("highlight");
  });
  bank.addEventListener("drop", (e) => {
    e.preventDefault();
    bank.classList.remove("highlight");

    const text = e.dataTransfer.getData("text/plain");
    const bankType = e.dataTransfer.getData("bank-type");
    const newEl = document.createElement("div");
    newEl.classList.add("draggable");
    newEl.setAttribute("draggable","true");
    if (bankType === "process") {
      newEl.classList.add("process-item");
    } else {
      newEl.classList.add("agent-item");
    }
    newEl.textContent = text;
    // Put dragstart logic so it can be moved again from the bank
    newEl.addEventListener("dragstart", onBankItemDragStart);

    bank.appendChild(newEl);
  });
});

// ---------------- BUTTONS ----------------
document.getElementById("checkButton").addEventListener("click", onCheck);
document.getElementById("retryButton").addEventListener("click", onRestart);
document.getElementById("copyButton").addEventListener("click", onCopy);

// ---------------- DRAG FUNCTIONS ----------------

// Bank -> Cell (Clone approach)
function onBankItemDragStart(e) {
  const text = e.target.textContent;
  const isProc = e.target.classList.contains("process-item");
  e.dataTransfer.setData("text/plain", text);
  e.dataTransfer.setData("bank-type", isProc ? "process" : "agent");
  e.dataTransfer.effectAllowed = "copy";
}

// Cell -> Another Cell or back to Bank (Move occupant)
function onCellItemDragStart(e) {
  const text = e.target.textContent;
  const isProc = e.target.classList.contains("process-item");
  e.dataTransfer.setData("text/plain", text);
  e.dataTransfer.setData("bank-type", isProc ? "process" : "agent");
  e.dataTransfer.effectAllowed = "move";
}

function onDropzoneDragOver(e) {
  e.preventDefault();
  e.currentTarget.classList.add("highlight");
  e.dataTransfer.dropEffect = "copy";
}

function onDragLeave(e) {
  e.currentTarget.classList.remove("highlight");
}

function onDropzoneDrop(e) {
  e.preventDefault();
  e.currentTarget.classList.remove("highlight");

  // If occupant present => remove it (only 1 occupant per cell)
  const occupant = e.currentTarget.querySelector(".draggable");
  if (occupant) occupant.remove();

  // Build new occupant
  const text = e.dataTransfer.getData("text/plain");
  const bankType = e.dataTransfer.getData("bank-type");

  const newEl = document.createElement("div");
  newEl.classList.add("draggable");
  newEl.setAttribute("draggable","true");
  if (bankType === "process") {
    newEl.classList.add("process-item");
  } else {
    newEl.classList.add("agent-item");
  }
  newEl.textContent = text;
  // So user can drag it out of the cell later
  newEl.addEventListener("dragstart", onCellItemDragStart);

  e.currentTarget.appendChild(newEl);
}

// ---------------- CHECK LOGIC ----------------
function onCheck() {
  // Lock all draggables
  document.querySelectorAll(".draggable").forEach(d => {
    d.setAttribute("draggable","false");
  });
  // Clear old feedback
  document.querySelectorAll(".draggable").forEach(d => {
    d.classList.remove("correct","incorrect");
  });

  let allCorrect = true;
  const rows = document.querySelectorAll("#landformsTable tbody tr");
  rows.forEach((tr, i) => {
    const correctProc = landformsData[i].process;
    const correctAgent= landformsData[i].agent;

    const procCell  = tr.children[1];
    const agentCell = tr.children[2];

    const occupantP = procCell.querySelector(".draggable");
    if (!occupantP || occupantP.textContent !== correctProc) {
      if (occupantP) occupantP.classList.add("incorrect");
      allCorrect = false;
    } else {
      occupantP.classList.add("correct");
    }

    const occupantA = agentCell.querySelector(".draggable");
    if (!occupantA || occupantA.textContent !== correctAgent) {
      if (occupantA) occupantA.classList.add("incorrect");
      allCorrect = false;
    } else {
      occupantA.classList.add("correct");
    }
  });

  if (allCorrect) {
    document.getElementById("copyButton").style.display = "inline-block";
  } else {
    document.getElementById("copyButton").style.display = "none";
  }
}

// ---------------- RESTART ----------------
function onRestart() {
  // Remove occupant clones from all cells
  document.querySelectorAll(".dropzone .draggable").forEach(d => d.remove());

  // Re-enable bank items
  document.querySelectorAll(".draggable").forEach(d => {
    d.classList.remove("correct","incorrect");
    d.setAttribute("draggable","true");
  });
  // Hide "Copy"
  document.getElementById("copyButton").style.display = "none";
}

// ---------------- COPY COMPLETED TABLE ----------------
async function onCopy() {
  let text = "Landform\tDominant Process\tAgent of Formation\n";
  const rows = document.querySelectorAll("#landformsTable tbody tr");
  rows.forEach((tr, i) => {
    const land  = landformsData[i].landform;
    const proc  = tr.children[1].querySelector(".draggable")?.textContent || "";
    const agent = tr.children[2].querySelector(".draggable")?.textContent || "";
    text += `${land}\t${proc}\t${agent}\n`;
  });
  try {
    await navigator.clipboard.writeText(text);
    alert("Copied table to clipboard! You can now paste it into your notes.");
  } catch(e) {
    alert("Copy failed: " + e);
  }
}
</script>
</body>
</html>
